branches:  
  only:
    - master
    - staging
    - production
language: python
node_js:
  - '0.10'
python:
  - '2.7'
  - '3.3'
  - '3.4'
services:  
  #Enable docker service inside travis
  - docker
before_install:
  - sudo apt-get update
  - sudo apt-get install -qq libzmq3-dev pandoc libcurl4-gnutls-dev libmemcached-dev
  - pip install -U setuptools
  - pip install -r requirements-dev.txt
  - npm install .
  - docker login -e="$DOCKER_EMAIL" -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"
install:
  - pip install -r requirements.txt
  - invoke bower
  - invoke less
script:
  - invoke test
  - docker --version  # document the version travis is using
  - pip install --user awscli # install aws cli w/o sudo
  - export PATH=$PATH:$HOME/.local/bin # put aws in the path
  - eval $(aws ecr get-login --region us-east-1) #needs AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY envvars
  # build
  - docker build --no-cache -t $DOCKER_IMAGE_NAME .
  # tag the build
  - docker tag $DOCKER_IMAGE_NAME $DOCKER_IMAGE_NAME
  # push the image to the repository
  - docker push $DOCKER_IMAGE_NAME:latest
notifications:
  slack: 3blades:kDsouoROcGOm58UyVIvH1XhV 
env:
  - $DOCKER_IMAGE_NAME="860100747351.dkr.ecr.us-east-1.amazonaws.com/nbviewer"